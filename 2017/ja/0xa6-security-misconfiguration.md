# A6:2017 セキュリティの設定が適切ではない

| 脅威エージェント/攻撃手法 | セキュリティ上の弱点           | 影響               |
| -- | -- | -- |
| Access Lvl : 悪用難易度 3 | 流行度 3 : 検出難易度 3 | 技術的影響 2 : ビジネスへの影響 |
| 攻撃者は、パッチを当てていない穴を悪用したり、デフォルトのアカウントや使われていないページ、保護されていないファイルやディレクトリなどにアクセスし、権限無しにアクセスしたり、システム情報を取得したりします。| 不適切なセキュリティの設定は、どのレベルのアプリケーションスタックにも起こりえます。それはネットワークサービスやプラットフォーム、Webサーバ、アプリケーションサーバ、データベース、フレームワーク、カスタムコード、プレインストールしてある仮想マシンやコンテナ、ストレージです。自動化したスキャナーは、不適切な設定、つまりデフォルトのアカウントや設定、必要のないサービスやレガシーなオプションなどが使われているのを見つけるのに便利です。 | この欠陥によって、攻撃者は得てして権限無しにシステムのデータや機能にアクセスしてしまいます。場合によっては、そのような欠陥によってシステム全体が損なわれてしまいます。 ビジネスへの影響は、アプリケーションとデータにどの程度保護が必要とされているかによります。 |

## どんなアプリケーションが脆弱ですか？

アプリケーションが下記のようなら、恐らく脆弱です。

* アプリケーションスタックのあらゆる部分に渡って、適切にセキュリティを強化していない。クラウドサービス上でパーミッションを適切に設定していない
* 必要のない機能が有効になっていたり、インストールされていたりする(例えば、必要のないポートやサービス、ページ、アカウント、特権)
* デフォルトのアカウントとパスワードが有効になったまま変更されていない
* エラー処理がユーザーに対して、スタックトレースやその他余計な情報を含むエラーメッセージを見せる
* アップグレードしたシステムでは、最新のセキュリティ機能が無効になっているか正しく設定されていない
* アプリケーションサーバやアプリケーションフレームワーク(例えば、Struts、Spring、 ASP.NET)、ライブラリ、データベース等のセキュリティの設定が、安全な値に設定されていない
* サーバがセキュリテイヘッダーやディレクティブを送らなかったり、安全な値に設定されていなかったりする
* ソフトウェアが古いか脆弱である (**A9:2017-既知の脆弱性を持つコンポーネントの使用** を参照)

アプリケーションのセキュリティを設定するプロセスを一致協力して繰り返さないと、システムのリスクはより高くなります。

## 防止方法

安全にインストールするプロセスにおいては、下記を実施してください。

* 繰り返し強化するプロセスは、簡単にすぐ他の環境に展開され、正しくロックダウンすること。開発やQA、本番環境は完全に同じように設定し、それぞれの環境で別々の認証情報を使用すること。このプロセスを自動化し、新しい安全な環境をセットアップする際には、手間を最小限にすること
* プラットフォームは最小限のものとし、必要のない機能やコンポーネント、ドキュメント、サンプルを除くこと。使用しない機能とフレームワークは、削除もしくはインストールしないこと
* レビューを実施して、セキュリティ関連の記録と更新の全てに加え、パッチを管理するプロセスの一環としてパッチの設定を適切に更新すること(**A9:2017-既知の脆弱性を持つコンポーネントの使用** を参照)。クラウドストレージのパーミッションは、詳細にレビューすること (例えば、S3 バケットのパーミッション)
* セグメント化したアプリケーションアーキテクチャは、セグメンテーションやコンテナリゼーション、クラウドのセキュリティグループ(ACL)をともなったコンポーネントやテナント間に、効果的で安全な仕切りをもたらす
* セキュリティディレクティブをクライアントへ送ること。例えば [セキュリティヘッダー](https://www.owasp.org/index.php/OWASP_Secure_Headers_Project)
* プロセスを自動化して設定の有効性を検証し、環境全てに適用すること

## 攻撃シナリオの例

**シナリオ #1**: アプリケーションのサンプルが付属しているアプリケーションサーバであるにもかかわらず、プロダクションサーバからサンプルが削除されていない。このサンプルアプリケーションには、攻撃者がサーバに侵入する際によく使う既知の脆弱性がある。そのアプリケーションが管理用のコンソールでデフォルトのアカウントが変更されていないと、攻撃者はデフォルトのパスワードを使ってログインし、乗っ取ってしまう

**シナリオ #2**: ディレクトリリスティングがサーバ上で無効になっていない。攻撃者はそれを見つけ出し、やすやすとディレクトリを表示してしまう。攻撃者はコンパイル済みのJavaクラスを見つけてダウンロードし、デコンパイルしてからリバースエンジニアリングしてコードを見る。そして攻撃者は、そのアプリケーションの深刻なアクセス制御上の穴を見つける

**シナリオ #3**: アプリケーションサーバの設定が、詳細なエラーメッセージ(例えば、スタックトレース)をユーザーに返すようにになっている。これによって機密情報や脆弱であるとされているコンポーネントのバージョンといった潜在的な欠陥がさらされる恐れがある

**シナリオ #4**: クラウドサービスプロバイダは、他のCSPユーザーによるデフォルトでインターネットに公開された共有パーミッションを用意している。こうなると、機密情報がクラウドストレージに保存され、アクセスされてしまう

## 参考資料

### OWASP

* [OWASP Testing Guide: Configuration Management](https://www.owasp.org/index.php/Testing_for_configuration_management)
* [OWASP Testing Guide: Testing for Error Codes](https://www.owasp.org/index.php/Testing_for_Error_Code_(OWASP-IG-006))
* [OWASP Security Headers Project](https://www.owasp.org/index.php/OWASP_Secure_Headers_Project)

この分野でさらに知りたいのなら、 Application Security Verification Standard [V19 Configuration](https://www.owasp.org/index.php/ASVS_V19_Configuration)を参照してください。

### 外部資料

* [NIST Guide to General Server Hardening](https://csrc.nist.gov/publications/detail/sp/800-123/final)
* [CWE-2: Environmental Security Flaws](https://cwe.mitre.org/data/definitions/2.html)
* [CWE-16: Configuration](https://cwe.mitre.org/data/definitions/16.html)
* [CWE-388: Error Handling](https://cwe.mitre.org/data/definitions/388.html)
* [CIS Security Configuration Guides/Benchmarks](https://www.cisecurity.org/cis-benchmarks/)
* [Amazon S3 Bucket Discovery and Enumeration](https://blog.websecurify.com/2017/10/aws-s3-bucket-discovery.html)
