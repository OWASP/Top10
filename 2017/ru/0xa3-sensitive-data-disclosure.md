# A3:2017 Разглашение конфиденциальных данных

| Источники угроз/Векторы атак | Недостатки безопасности | Последствия |
| -- | -- | -- |
| Зависит от прил. : Сложность эксплуатации 2 | Распространенность 3 : Сложность обнаружения 2 | Технические 3 : Для бизнеса ? |
| Вместо взлома механизмов шифрования злоумышленники крадут ключи, проводят атаки по принципу "человек посередине" или получают данные в незашифрованном виде с сервера, в процессе их передачи или из клиента пользователя, например браузера. Подобные атаки обычно проводятся вручную. Ранее полученные базы данных паролей могут быть взломаны методом подбора с использованием графических процессоров. | На протяжении последних лет данная атака является самой распространенной и опасной. Чаще всего встречается отсутствие шифрования конфиденциальных данных, а при наличии часто используются ненадежные алгоритмы, протоколы, шифры, методы хранения хешированных паролей или методы создания и управления ключами. Также легко обнаружить уязвимости на стороне сервера для передаваемых данных, но не хранимых. | Из-за уязвимости часто страдают все персональные данные (медицинские записи, учетные данные, данные кредитных карт), которые должны быть защищены по закону, например в соответствии с Общим регламентом ЕС по защите данных (GDPR) или локальными законами о неприкосновенности данных. |

## Является ли приложение уязвимым?

Прежде всего необходимо определить требуемый уровень защиты данных при их передаче и хранении. Например, пароли, номера кредитных карт, медицинские записи, персональные данные и коммерческие тайны требуют дополнительной защиты, особенно если они подпадают под действие закона о неприкосновенности данных (напр., Общего регламента ЕС по защите данных (GDPR)) или закона о защите финансовых данных (напр., Стандарта безопасности данных в сфере платежных карт (PCI DSS)).

- Шифруются ли передаваемые данные? Это касается протоколов передачи данных, таких как HTTP, SMTP и FTP. Особенно опасен внешний интернет-трафик. Проверьте весь внутренний трафик, например между балансировщиками нагрузки, веб-серверами и внутренними системами.
- Шифруются ли хранилища важных данных, а также резервные копии?
- Используются ли по умолчанию или в более ранних версиях устаревшие или ненадежные алгоритмы шифрования?
- Используются ли созданные по умолчанию, ненадежные или одинаковые шифроключи, а также применяются ли соответствующие механизмы контроля и смены ключей?
- Используется ли шифрование, например присутствуют ли директивы безопасности пользовательских агентов (браузеров) и заголовки?
- Проверяет ли пользовательский агент (напр., приложение или почтовый клиент) действительность полученных сертификатов?

См. Стандарт подтверждения безопасности приложений: [Криптография (V7)](https://github.com/OWASP/ASVS/blob/v4.0.2/4.0/en/0x14-V6-Cryptography.md), [Защита данных (V9)](https://github.com/OWASP/ASVS/blob/v4.0.2/4.0/en/0x16-V8-Data-Protection.md) и [SSL/TLS (V9)](https://github.com/OWASP/ASVS/blob/v4.0.2/4.0/en/0x17-V9-Communications.md).

## Как предотвратить?

Выполните как минимум следующее, а также ознакомьтесь с материалами в разделе "Ссылки":

- Классифицируйте данные, обрабатываемые, хранимые или передаваемые приложением. Определите, какие из них являются конфиденциальными согласно законам о неприкосновенности данных, нормативам или бизнес-требованиям.
- Реализуйте требования согласно классификации.
- Не храните конфиденциальные данные без необходимости. Сразу удаляйте их или используйте токенизацию или усечение, соответствующие стандарту PCI DSS. Данные, которые не сохраняются, нельзя украсть.
- Обеспечьте шифрование всех хранимых конфиденциальных данных.
- Обеспечьте применение современных и надежных алгоритмов, протоколов и ключей, а также используйте соответствующие механизмы управления ключами.
- Шифруйте все передаваемые данные с помощью надежного протокола, например TLS с совершенной прямой секретностью (PFS), приоритизацией шифров сервером и безопасными настройками. Обеспечьте принудительное шифрование, например используя механизм принудительного использования HTTPS (HSTS).
- Отключите кэширование ответов, содержащих конфиденциальные данные.
- Сохраняйте пароли с помощью надежных, адаптивных функций хеширования с солью и фактором трудоемкости (задержки), таких как [Argon2](https://github.com/p-h-c/phc-winner-argon2), [scrypt](https://wikipedia.org/wiki/Scrypt), [bcrypt](https://wikipedia.org/wiki/Bcrypt) или [PBKDF2](https://wikipedia.org/wiki/PBKDF2).
- Проверяйте отдельно эффективность конфигурации и настройки.

## Примеры сценариев атак

**Сценарий №1**: Приложение шифрует номера кредитных карт в базе данных, используя автоматическое шифрование БД. Однако эти данные автоматически расшифровываются при извлечении, позволяя с помощью внедрения SQL-кода получить данные кредитных карт в незашифрованном виде.

**Сценарий №2**: Сайт не использует TLS для всех страниц или поддерживает ненадежное шифрование. Злоумышленник может просмотреть сетевой трафик (например, в небезопасной беспроводной сети), переключить соединение с HTTPS на HTTP, перехватить запросы и похитить сессионные куки. После этого он может использовать полученные куки для перехвата сессии пользователя (прошедшего аутентификацию), изменив личные данные пользователя. Также злоумышленник может изменить все передаваемые данные, например получателя денежного перевода.

**Сценарий №3**: Для сохранения паролей в базе данных не используется соль или используется простой алгоритм хеширования. Уязвимость в загрузке файлов позволяет злоумышленнику получить БД паролей. Все хеш-значения без соли могут быть восстановлены с помощью радужной таблицы предварительно расчитанных хешей. Хеш-значения, рассчитанные с использованием простых или быстрых хеш-функций, могут быть взломаны с помощью графических процессоров, даже если для них использовалась соль. 

## Ссылки

### OWASP

- [Проактивная защита OWASP: Защита данных](https://owasp.org/www-project-proactive-controls/v3/en/c8-protect-data-everywhere)
- [Стандарт подтверждения безопасности приложений OWASP](https://owasp.org/www-project-application-security-verification-standard/): [V6](https://github.com/OWASP/ASVS/blob/v4.0.2/4.0/en/0x14-V6-Cryptography.md), [9](https://github.com/OWASP/ASVS/blob/v4.0.2/4.0/en/0x16-V8-Data-Protection.md), [10](https://github.com/OWASP/ASVS/blob/v4.0.2/4.0/en/0x17-V9-Communications.md)
- [Памятка OWASP: Защита транспортного уровня](https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html)
- [Памятка OWASP: Защита конфиденциальности пользователей](https://cheatsheetseries.owasp.org/cheatsheets/User_Privacy_Protection_Cheat_Sheet.html)
- [Памятка OWASP: Хранение паролей](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html) и [хранение в зашифрованном виде](https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html)
- [Проект OWASP: Безопасные заголовки](https://owasp.org/www-project-secure-headers/); [Памятка по HSTS](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html)
- [Руководство OWASP по тестированию: Проверка надежности шифрования](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/README)

### Сторонние

- [CWE-202: Разглашение конфиденциальных данных, связанное с запросами](https://cwe.mitre.org/data/definitions/202.html)
- [CWE-310: Уязвимости, связанные с криптографией](https://cwe.mitre.org/data/definitions/310.html); [CWE-311: Отсутствие шифрования](https://cwe.mitre.org/data/definitions/311.html)
- [CWE-312: Хранение критичных данных в незашифрованном виде](https://cwe.mitre.org/data/definitions/312.html)
- [CWE-319: Передача критичных данных в незашифрованном виде](https://cwe.mitre.org/data/definitions/319.html)
- [CWE-326: Ненадежное шифрование](https://cwe.mitre.org/data/definitions/326.html); [CWE-327: Скомпрометированный криптоалгоритм](https://cwe.mitre.org/data/definitions/327.html)
- [CWE-359: Разглашение личных данных (Нарушение конфиденциальности)](https://cwe.mitre.org/data/definitions/359.html)