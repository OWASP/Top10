# A10:2017 Недостатки журналирования и мониторинга

| Источники угроз/Векторы атак | Недостатки безопасности           | Последствия               |
| -- | -- | -- |
| Зависит от прил. : Сложность эксплуатации 2 | Распространенность 3 : Сложность обнаружения 1 | Технические 2 : Для бизнеса ? |
| Эксплуатация недостатков журналирования и мониторинга лежит в основе почти всех крупных взломов. При проведении атак злоумышленники полагаются на отсутствие контроля и своевременного реагирования на инциденты.  | Данная уязвимость включена в Топ-10 по результатам [отраслевых исследований](https://owasp.blogspot.com/2017/08/owasp-top-10-2017-project-update.html). Одним из способов определить качество мониторинга является анализ журналов после проведения теста на проникновение. Для определения возможного ущерба все действия тестировщиков должны регистрироваться соответствующим образом. | Большинство атак начинаются с анализа уязвимостей. Возможность проведения подобного анализа повышает вероятность удачной эксплуатации уязвимости практически до 100%. В 2016 году обнаружение факта проникновения занимало [в среднем 191 день](https://www-01.ibm.com/common/ssi/cgi-bin/ssialias?htmlfid=SEL03130WWEN&) — нанесенный за это время ущерб мог быть огромным. |

## Является ли приложение уязвимым?

Недостатки журналирования, обнаружения атак, мониторинга и реагирования на инциденты выявляются постоянно:

* подвергаемые аудиту события, такие как удачные и неудачные попытки входа в систему, а также важные транзакции, не регистрируются;
* предупреждения и ошибки не регистрируются или регистрируются некорректно;
* журналы приложений и API не проверяются на предмет подозрительной активности;
* журналы хранятся только локально;
* пороговые значения предупреждений и схемы реагирования на инциденты отсутствуют или являются неэффективными;
* тестирование на проникновение и сканирование инструментами [DAST](https://www.owasp.org/index.php/Category:Vulnerability_Scanning_Tools) (например, [OWASP ZAP](https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project)) не выдают предупреждений;
* приложение не может определять, реагировать или предупреждать об атаках в реальном или почти реальном времени.

В системе имеется утечка данных, если журналы регистрации и предупреждения доступны пользователям или атакующим (см. **A3:2017-Разглашение конфиденциальных данных**).

## Как предотвратить

Исходя из критичности данных, хранимых или обрабатываемых приложением, необходимо:

* регистрировать все ошибки входа, доступа и проверки данных на стороне сервера с указанием контекста, достаточного для выявления подозрительных или вредоносных действий, а также хранить их для последующего анализа;
* регистрировать события в формате, наиболее подходящем для обработки централизованной службой журналирования;
* использовать контроль целостности журналов аудита важных транзакций для предотвращения подмены или удаления данных, например, с помощью доступных только для добавления таблиц БД;
* использовать эффективные системы мониторинга и предупреждения для своевременного обнаружения подозрительных действий и реагирования на них;
* разработать или утвердить руководство по реагированию на инциденты и устранению их последствий, такое как [NIST 800-61 rev 2](https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final).

Существуют коммерческие и бесплатные системы защиты приложений (например, [OWASP AppSensor](https://www.owasp.org/index.php/OWASP_AppSensor_Project)), межсетевые экраны веб-приложений (например, [ModSecurity с набором основных правил OWASP ModSecurity](https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project)), а также программы корреляции журналов с настраиваемыми панелями и предупреждениями.

## Примеры сценариев атак

**Сценарий №1**: Форум открытого проекта, используемый небольшой командой, был взломан через уязвимость в его ПО. Злоумышленники удалили внутренний репозиторий, содержащий следующую версию продукта, а также все содержимое форума. Несмотря на возможность восстановления источника, отсутствие мониторинга, журналирования или оповещений привело к более серьезным последствиям. Из-за инцидента программный проект с форума более не развивается.

**Сценарий №2**: Злоумышленник может использовать один стандартный пароль для проверки доступа ко всем учетным записям, к некоторым из них он может подойти. Для остальных будет зарегистрирована лишь неудачная попытка входа. Через несколько дней попытка может повториться, но уже с другим паролем.

**Сценарий №3**: В крупной торговой сети имеется песочница для внутреннего анализа вредоносных вложений. Средства песочницы обнаружили потенциально вредоносное ПО, но никто не обращал внимания на получаемые от песочницы предупреждения, пока взлом не обнаружили в связи с мошенническими транзакциями по банковским картам от стороннего банка.

## Ссылки

### OWASP

* [Проактивная защита OWASP: Реализация журналирования и обнаружения вторжений](https://www.owasp.org/index.php/OWASP_Proactive_Controls#8:_Implement_Logging_and_Intrusion_Detection)
* [Стандарт подтверждения безопасности приложений OWASP: V8 Журналирование и мониторинг](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project#tab=Home)
* [Руководство OWASP по тестированию: Подробные коды ошибок](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project#tab=Home)
* [Памятка OWASP: Журналирование](https://www.owasp.org/index.php/Logging_Cheat_Sheet)

### Сторонние

* [CWE-223: Отсутствие регистрации или отображения данных, относящихся к безопасности](https://cwe.mitre.org/data/definitions/223.html)
* [CWE-778: Некорректное журналирование](https://cwe.mitre.org/data/definitions/778.html)
